
policyApp.controller('dataSetCtrl',['$scope','$http','$location','$window','$timeout','$filter','$rootScope','$localStorage','ModalService','RulesEngineService','alertService',function($scope,$http,$location,$window,$timeout,$filter,$rootScope,$localStorage,ModalService,RulesEngineService,alertService){$scope.disableSelect=true;$scope.status=true;$scope.changeStatus=function(){$scope.status=!$scope.status;}
$('.btn-toggle').click(function(){$(this).find('.btn').toggleClass('active');if($(this).find('.btn-primary').size()>0){$(this).find('.btn').toggleClass('btn-primary');}
$(this).find('.btn').toggleClass('btn-default');});$scope.selectDataSet=function(getResp){var dataType;$scope.dataType=getResp.dataSets;if(getResp.dataSets===null||getResp.dataSets===undefined){getResp.dataSets=[];getResp.dataSets.push(dataType);}};$scope.getDataSet=function(){var url='data-set'+'/'+$localStorage.selectedId+'/'+'~';RulesEngineService.getAllData(url).then(function(getResp){$scope.selectDataSet(getResp);},function(error){$rootScope.errorNotification();});};$rootScope.fetchUpdatedList=function(){$scope.fetchDataList();}
$scope.fetchDataList=function(){$scope.disableSelect=false;$scope.dataSetTextArea="";var withData='with-data';var url='data-set'+'/'+$localStorage.selectedId+'/'+$scope.selectedItem+'/'+withData;RulesEngineService.getAllData(url).then(function(getList){$scope.items=getList.dataSets[0].data;$scope.getArray=[];angular.forEach($scope.items,function(item,index){var tempVar={a:item};$scope.getArray.push(tempVar);});$scope.search();},function(error){$rootScope.errorNotification();});};var sortingOrder='dataList';$scope.sortingOrder=sortingOrder;$scope.pageSizes=[25,50,100,200,300,500,1000];$scope.reverse=false;$scope.filteredItems=[];$scope.groupedItems=[];$scope.gap=10;$scope.itemsPerPage=25;$scope.pagedItems=[];$scope.currentPage=0;var searchMatch=function(haystack,needle){if(!needle){return true;}
return haystack.toLowerCase().indexOf(needle.toLowerCase())!==-1;};$scope.search=function(){$scope.filteredItems=$filter('filter')($scope.items,function(item){if(searchMatch(item,$scope.query))
return true;return false;});if($scope.sortingOrder!==''){$scope.filteredItems=$filter('orderBy')($scope.filteredItems,$scope.sortingOrder,$scope.reverse);}
$scope.currentPage=0;$scope.groupToPages();};$scope.perPage=function(){$scope.groupToPages();};$scope.groupToPages=function(){$scope.pagedItems=[];for(var i=0;i<$scope.filteredItems.length;i++){if(i%$scope.itemsPerPage===0){$scope.pagedItems[Math.floor(i/$scope.itemsPerPage)]=[$scope.filteredItems[i]];}else{$scope.pagedItems[Math.floor(i/$scope.itemsPerPage)].push($scope.filteredItems[i]);}}};$scope.deleteSingleItem=function(index){var operation="delete";var dataSetJson;var itemToDelete=$scope.pagedItems[$scope.currentPage][index];dataSetJson={id:$scope.selectedItem,data:itemToDelete};$scope.showConfirmModal(dataSetJson,operation,index);};$scope.showConfirmModal=function(dataSetJson,operation,index){ModalService.showModal({templateUrl:'views/confirmModal.html',controller:"confirmModalCtrl",inputs:{deleteItem:$scope.items[index]}}).then(function(modal){modal.element.modal();modal.close.then(function(result){if(result==='Yes'){$scope.doPostCall(dataSetJson,operation);}});});};$scope.doPostCall=function(dataSetJson,operation){var url='data-set'+'/'+$localStorage.selectedId+'/'+$scope.selectedItem+'/'+operation;RulesEngineService.postAllData(dataSetJson,url).then(function(){$rootScope.deleteNotification();$scope.fetchDataList();$scope.search();},function(error){$scope.fetchDataList();$rootScope.errorNotification();});};$scope.addRecordsModal=function(){ModalService.showModal({templateUrl:'views/addNdeleteRecordsModal.html',controller:"addNdeleteRecordsModalCtrl",inputs:{modalType:'add',selectedItem:$scope.selectedItem,items:$scope.items}}).then(function(modal){modal.element.modal();modal.close.then(function(){});});};$scope.deleteRecordsModal=function(){ModalService.showModal({templateUrl:'views/addNdeleteRecordsModal.html',controller:"addNdeleteRecordsModalCtrl",inputs:{modalType:'delete',selectedItem:$scope.selectedItem,items:$scope.items}}).then(function(modal){modal.element.modal();modal.close.then(function(){});});};$scope.range=function(size,start,end){var ret=[];if(size>0&&size<end&&size<1){end=size;start=size-$scope.gap;}
else if(!size){end=start;start=0;}
for(var i=start;i<end;i++){ret.push(i);}
return ret;};$scope.prevPage=function(){if($scope.currentPage>0){$scope.currentPage--;}};$scope.nextPage=function(){if($scope.currentPage<$scope.pagedItems.length-1){$scope.currentPage++;}};$scope.setPage=function(){$scope.currentPage=this.n;};$scope.sort_by=function(newSortingOrder){if($scope.sortingOrder==newSortingOrder)
$scope.reverse=!$scope.reverse;$scope.sortingOrder=newSortingOrder;};$scope.getDataSet();}]);policyApp.directive('allowPattern',[allowPatternDirective]);function allowPatternDirective(){return{restrict:"A",compile:function(tElement,tAttrs){return function(scope,element,attrs){element.bind("keypress",function(event){var keyCode=event.which||event.keyCode;var keyCodeChar=String.fromCharCode(keyCode);if(!keyCodeChar.match(new RegExp(attrs.allowPattern,"i"))){event.preventDefault();return false;}});};}};}